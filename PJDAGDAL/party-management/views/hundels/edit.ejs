<%- include('../partials/head', { title: 'تعديل Hundel' }) %>
<%- include('../partials/header') %>

  <style>
    .form { max-width:600px }
    label { display:block; margin-top:8px }
    input, textarea, select { width:100%; padding:8px; box-sizing:border-box }
    button { margin-top:12px }
  </style>

  <%- include('../partials/card-open', { title: 'تعديل Hundel' }) %>
            <div id="msg" style="color:#c00"></div>
            <form id="form" class="form">
    <label>الاسم</label>
    <input id="name" required />

    <label>الوصف</label>
    <textarea id="description"></textarea>

  <label>الحالة</label>
  <select id="status"><option value="active">نشط</option><option value="inactive">غير نشط</option></select>

    <button type="submit">حفظ</button>
  </form>

  <script>
  // use cookie-based auth; UI routes protected server-side
    const id = '<%= id %>';
    const msg = document.getElementById('msg');
    const form = document.getElementById('form');

    async function load() {
      try {
  const r = await safeFetchJson('/api/hundels/' + id, { credentials: 'same-origin' });
        if (!r.ok) { if (r.status === 401) { localStorage.removeItem('token'); location.href='/login' } msg.textContent = 'فشل التحميل'; return; }
        const data = r.data || {};
        document.getElementById('name').value = data.name || '';
        document.getElementById('description').value = data.description || '';
        document.getElementById('status').value = data.status || 'active';
      } catch (err) { console.error(err); msg.textContent = 'خطأ بالشبكة'; }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault(); msg.textContent = '';
      const body = { name: document.getElementById('name').value, description: document.getElementById('description').value, status: document.getElementById('status').value };
  try {
  const r = await safeFetchJson('/api/hundels/' + id, { method: 'PUT', credentials: 'same-origin', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
    if (!r.ok) { msg.textContent = (r.data && r.data.message) ? r.data.message : 'فشل الحفظ'; return; }
    location.href = '/hundels';
  } catch (err) { console.error(err); msg.textContent = 'خطأ بالشبكة'; }
    });

    load();
  </script>


<%- include('../partials/footer') %>
  <%- include('../partials/card-close') %>


